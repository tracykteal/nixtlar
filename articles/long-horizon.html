<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Long-Horizon Forecasting • nixtlar</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Long-Horizon Forecasting">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nixtlar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/get-started.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://docs.nixtla.io/">Nixtla</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/anomaly-detection.html">Anomaly Detection</a></li>
    <li><a class="dropdown-item" href="../articles/cross-validation.html">Cross-Validation</a></li>
    <li><a class="dropdown-item" href="../articles/data-requirements.html">Data requirements</a></li>
    <li><a class="dropdown-item" href="../articles/exogenous-variables.html">Exogenous Variables</a></li>
    <li><a class="dropdown-item" href="../articles/historical-forecast.html">Historical Forecast</a></li>
    <li><a class="dropdown-item" href="../articles/long-horizon.html">Long Horizon Forecast</a></li>
    <li><a class="dropdown-item" href="../articles/prediction-intervals.html">Prediction Intervals</a></li>
    <li><a class="dropdown-item" href="../articles/quantiles.html">Quantile Forecasts</a></li>
    <li><a class="dropdown-item" href="../articles/setting-up-your-api-key.html">Setting Up Your API Key</a></li>
    <li><a class="dropdown-item" href="../articles/special-topics.html">Special Topics</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Nixtla/nixtlar"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Long-Horizon Forecasting</h1>
            
      

      <div class="d-none name"><code>long-horizon.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nixtla.github.io/nixtlar/">nixtlar</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Registered S3 method overwritten by 'tsibble':</span></span>
<span><span class="co">#&gt;   method               from </span></span>
<span><span class="co">#&gt;   as_tibble.grouped_df dplyr</span></span></code></pre></div>
<div class="section level2">
<h2 id="long-horizon-forecasting">1. Long-horizon forecasting<a class="anchor" aria-label="anchor" href="#long-horizon-forecasting"></a>
</h2>
<p>For some problems, it is necessary to forecast long horizons. Here
“long horizons” refer to predictions that exceed more than two seasonal
periods. For instance, this means predicting more than 48 hours ahead
for hourly data, and more than 7 days for daily data. The specific
definition of “long horizon” varies according to the frequency of the
data.</p>
<p><code>TimeGPT</code> features a specialized model designed for
long-horizon forecasting. This model is trained to predict far into the
future, where the uncertainty increases as the forecast extends further.
Here we’ll explain how to use the long horizon model of
<code>TimeGPT</code>.</p>
<p>This vignette will explain how to do this. It assumes you have
already set up your API key. If you haven’t done this, please read the
<a href="https://nixtla.github.io/nixtlar/articles/anomaly-detection.html">Get
Started</a> vignette first.</p>
</div>
<div class="section level2">
<h2 id="load-data">2. Load data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h2>
<p>For this vignette, we’ll use the electricity consumption dataset that
is included in <code>nixtlar</code>, which contains the hourly prices of
five different electricity markets.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">nixtlar</span><span class="fu">::</span><span class="va"><a href="../reference/electricity.html">electricity</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt;   unique_id                  ds     y</span></span>
<span><span class="co">#&gt; 1        BE 2016-10-22 00:00:00 70.00</span></span>
<span><span class="co">#&gt; 2        BE 2016-10-22 01:00:00 37.10</span></span>
<span><span class="co">#&gt; 3        BE 2016-10-22 02:00:00 37.10</span></span>
<span><span class="co">#&gt; 4        BE 2016-10-22 03:00:00 44.75</span></span>
<span><span class="co">#&gt; 5        BE 2016-10-22 04:00:00 37.10</span></span>
<span><span class="co">#&gt; 6        BE 2016-10-22 05:00:00 35.61</span></span></code></pre></div>
<p>For every <code>unique_id</code>, we’ll try to predict the last 96
hours. Hence, we’ll separate the data into training and test
datasets.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">unique_id</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_tail</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">96</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">ds</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">ds</span>, <span class="va">test</span><span class="op">$</span><span class="va">ds</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="forecast-with-a-long-horizon">3. Forecast with a long-horizon<a class="anchor" aria-label="anchor" href="#forecast-with-a-long-horizon"></a>
</h2>
<p>To use the long-horizon model of <code>TimeGPT</code>, set the
<code>model</code> argument to <code>timegpt-1-long-horizon</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fcst_long_horizon</span> <span class="op">&lt;-</span> <span class="fu">nixtlar</span><span class="fu">::</span><span class="fu"><a href="../reference/nixtla_client_forecast.html">nixtla_client_forecast</a></span><span class="op">(</span><span class="va">train</span>, h<span class="op">=</span><span class="fl">96</span>, id_col<span class="op">=</span><span class="st">"unique_id"</span>, model<span class="op">=</span><span class="st">"timegpt-1-long-horizon"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Frequency chosen: H</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fcst_long_horizon</span><span class="op">)</span></span>
<span><span class="co">#&gt;   unique_id                  ds  TimeGPT</span></span>
<span><span class="co">#&gt; 1        BE 2016-12-27 00:00:00 42.73139</span></span>
<span><span class="co">#&gt; 2        BE 2016-12-27 01:00:00 38.03034</span></span>
<span><span class="co">#&gt; 3        BE 2016-12-27 02:00:00 35.11705</span></span>
<span><span class="co">#&gt; 4        BE 2016-12-27 03:00:00 34.53508</span></span>
<span><span class="co">#&gt; 5        BE 2016-12-27 04:00:00 34.11481</span></span>
<span><span class="co">#&gt; 6        BE 2016-12-27 05:00:00 38.36356</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-the-long-horizon-forecast">4. Plot the long-horizon forecast<a class="anchor" aria-label="anchor" href="#plot-the-long-horizon-forecast"></a>
</h2>
<p><code>nixtlar</code> includes a function to plot the historical data
and any output from <code><a href="../reference/nixtla_client_forecast.html">nixtlar::nixtla_client_forecast</a></code>,
<code><a href="../reference/nixtla_client_historic.html">nixtlar::nixtla_client_historic</a></code>,
<code><a href="../reference/nixtla_client_detect_anomalies.html">nixtlar::nixtla_client_detect_anomalies</a></code> and
<code><a href="../reference/nixtla_client_cross_validation.html">nixtlar::nixtla_client_cross_validation</a></code>. If you have long
series, you can use <code>max_insample_length</code> to only plot the
last N historical values (the forecast will always be plotted in
full).</p>
<p>When using <code><a href="../reference/nixtla_client_plot.html">nixtlar::nixtla_client_plot</a></code> with the output
of <code><a href="../reference/nixtla_client_detect_anomalies.html">nixtlar::nixtla_client_detect_anomalies</a></code>, set
<code>plot_anomalies=TRUE</code> to plot the anomalies.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nixtlar</span><span class="fu">::</span><span class="fu"><a href="../reference/nixtla_client_plot.html">nixtla_client_plot</a></span><span class="op">(</span><span class="va">train</span>, <span class="va">fcst_long_horizon</span>, id_col<span class="op">=</span><span class="st">"unique_id"</span>, max_insample_length <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="co">#&gt; Frequency chosen: H</span></span></code></pre></div>
<p><img src="long-horizon_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="evaluate-the-long-horizon-model">5. Evaluate the long-horizon model<a class="anchor" aria-label="anchor" href="#evaluate-the-long-horizon-model"></a>
</h2>
<p>To evaluate the long-horizon forecast, we’ll generate the same
forecast with the default model of <code>TimeGPT</code>, which is
<code>timegpt-1</code>, and then we’ll compute and compare the <a href="https://en.wikipedia.org/wiki/Mean_absolute_error" class="external-link">Mean Absolute
Error</a> (MAE) of the two models.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fcst</span> <span class="op">&lt;-</span> <span class="fu">nixtlar</span><span class="fu">::</span><span class="fu"><a href="../reference/nixtla_client_forecast.html">nixtla_client_forecast</a></span><span class="op">(</span><span class="va">train</span>, h<span class="op">=</span><span class="fl">96</span>, id_col<span class="op">=</span><span class="st">"unique_id"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Frequency chosen: H</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fcst</span><span class="op">)</span></span>
<span><span class="co">#&gt;   unique_id                  ds  TimeGPT</span></span>
<span><span class="co">#&gt; 1        BE 2016-12-27 00:00:00 45.21922</span></span>
<span><span class="co">#&gt; 2        BE 2016-12-27 01:00:00 42.56666</span></span>
<span><span class="co">#&gt; 3        BE 2016-12-27 02:00:00 41.55990</span></span>
<span><span class="co">#&gt; 4        BE 2016-12-27 03:00:00 39.12502</span></span>
<span><span class="co">#&gt; 5        BE 2016-12-27 04:00:00 36.47087</span></span>
<span><span class="co">#&gt; 6        BE 2016-12-27 05:00:00 37.22281</span></span></code></pre></div>
<p>We’ll rename the <code>TimeGPT</code> long-horizon model to merge it
with the default <code>TimeGPT</code> model. We’ll then merge them with
the actual values from the test set and compute the MAE. Note that in
the output of the <code>nixtla_client_forecast</code> function, the
<code>ds</code> column contains dates. This is because the
<code>nixtla_client_plot</code> uses the dates to make the plot.
However, to merge the actual values, we’ll convert them to
characters.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fcst_long_horizon</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fcst_long_horizon</span><span class="op">)</span> <span class="op">==</span> <span class="st">"TimeGPT"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"TimeGPT-long-horizon"</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">fcst</span>, <span class="va">fcst_long_horizon</span><span class="op">)</span> <span class="co"># merge TimeGPT and TimeGPT-long-horizon</span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">ds</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">test</span>, <span class="va">res</span><span class="op">)</span> <span class="co"># merge with actual values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="co">#&gt;   unique_id                  ds     y  TimeGPT TimeGPT-long-horizon</span></span>
<span><span class="co">#&gt; 1        BE 2016-12-27 01:00:00 38.33 42.56666             38.03034</span></span>
<span><span class="co">#&gt; 2        BE 2016-12-27 02:00:00 41.04 41.55990             35.11705</span></span>
<span><span class="co">#&gt; 3        BE 2016-12-27 03:00:00 34.62 39.12502             34.53508</span></span>
<span><span class="co">#&gt; 4        BE 2016-12-27 04:00:00 29.69 36.47087             34.11481</span></span>
<span><span class="co">#&gt; 5        BE 2016-12-27 05:00:00 28.35 37.22281             38.36356</span></span>
<span><span class="co">#&gt; 6        BE 2016-12-27 06:00:00 30.99 42.28119             47.14342</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"MAE TimeGPT: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">y</span><span class="op">-</span><span class="va">res</span><span class="op">$</span><span class="va">TimeGPT</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "MAE TimeGPT: 8.89928788925622"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"MAE TimeGPT long-horizon: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">y</span><span class="op">-</span><span class="va">res</span><span class="op">$</span><span class="va">`TimeGPT-long-horizon`</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "MAE TimeGPT long-horizon: 7.0978545972099"</span></span></code></pre></div>
<p>As we can see, the long-horizon version of <code>TimeGPT</code>
produced a model with a lower MAE than the default <code>TimeGPT</code>
model.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mariana Menchero.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
